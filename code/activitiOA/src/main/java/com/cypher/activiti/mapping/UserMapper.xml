<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cypher.activiti.dao.UserMapper">
	<!-- 所有字符 sql片段 -->
	<sql id="all_user_columns">
		USER_ID,DEPT_ID,LOGIN_NAME,PASSWORD,
		USER_NO,USER_NAME,EMAIL,PHONE,MOBILE,
		UPDATE_BY,UPDATE_DATE,REMARKS
	</sql>

	<!--将通用的sql查询条件抽取出来,成为sql片段 ,给不同方法应用 -->
	<sql id="query_user_sql_where">
		<if test="userName!=null">
			AND USER_NAME LIKE '%${userName}%'
		</if>
		<if test="loginName!=null">
			AND LOGIN_NAME= #{loginName}
		</if>
		<if test="password!=null">
			AND PASSWORD= #{password}
		</if>
	</sql>

	<!--根据条件查询 用户列表 -->
	<select id="getUserList" parameterType="user" resultType="user">
		SELECT
		<include refid="all_user_columns"></include>
		FROM PM_SYS_USER
		<where>
			<include refid="query_user_sql_where"></include>
		</where>
	</select>

	<!--根据用户id查询 用户信息 -->
	<select id="getUserInfoById" parameterType="long" resultType="userDto">
		SELECT

		A.USER_ID,A.DEPT_ID,A.LOGIN_NAME,A.PASSWORD,
		A.USER_NO,A.USER_NAME,A.EMAIL,A.PHONE,A.MOBILE,
		A.UPDATE_BY,A.UPDATE_DATE,A.REMARKS,B.NAME DEPT_NAME

		FROM PM_SYS_USER
		A,PM_SYS_DEPT B

		WHERE A.USER_ID=#{userId} AND A.DEPT_ID = B.ID
	</select>

	<!--保存用户信息 -->
	<update id="updateUser" parameterType="user">
		UPDATE PM_SYS_USER
		<set>
			<if test="loginName != null">
				LOGIN_NAME = #{loginName},
			</if>
			<if test="userNo != null">
				USER_NO = #{userNo},
			</if>
			<if test="userName != null">
				USER_NAME = #{userName},
			</if>
			<if test="email != null">
				EMAIL = #{email},
			</if>
			<if test="phone != null">
				PHONE = #{phone},
			</if>
			<if test="mobile != null">
				MOBILE = #{mobile},
			</if>
			<if test="updateBy != null">
				UPDATE_BY = #{updateBy},
			</if>
			<if test="updateDate != null">
				UPDATE_DATE = #{updateDate},
			</if>
			<if test="remarks != null">
				REMARKS = #{remarks},
			</if>
		</set>
		WHERE USER_ID = #{userId}
	</update>

	<!--保存用户修改密码 -->
	<update id="updatePwd">
		UPDATE PM_SYS_USER SET PASSWORD = #{1}
		WHERE USER_ID = #{0}
	</update>
</mapper>